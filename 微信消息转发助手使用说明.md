# 微信消息转发助手使用说明

## 项目简介

微信消息转发助手是一个基于wxauto的工具，可以实现普通微信和企业微信之间的消息自动转发功能。特别适用于需要在个人微信和工作微信之间转发消息的场景。

## 功能特点

- ✅ **双向转发**: 支持普通微信 ↔ 企业微信之间的消息转发
- ✅ **灵活配置**: 可以设置消息来源、转发目标和过滤条件
- ✅ **智能过滤**: 支持转发所有消息、仅@本人消息、指定范围消息
- ✅ **图形界面**: 提供友好的GUI界面进行配置和监控
- ✅ **日志记录**: 实时显示转发日志，便于监控和调试
- ✅ **配置保存**: 支持保存和加载转发配置

## 重要说明

### 企业微信限制

经过深入分析发现，**企业微信主窗口使用了自定义渲染技术，无法通过UIAutomation直接操作内部控件**。但是：

1. **企业微信独立聊天窗口可能支持UIAutomation操作**
2. **需要以管理员权限运行程序**
3. **建议使用企业微信的独立聊天窗口功能**

### 解决方案

本工具采用了以下策略：
- 对于普通微信：直接使用UIAutomation操作
- 对于企业微信：通过独立聊天窗口进行操作
- 提供测试工具验证企业微信窗口的可操作性

## 安装要求

### 环境要求
- Windows 10/11
- Python 3.9+
- 管理员权限

### 依赖包
```bash
pip install wxauto
```

### 微信版本
- 普通微信：3.9.X 版本
- 企业微信：最新版本

## 使用步骤

### 1. 环境准备

1. **启动微信应用**
   - 启动并登录普通微信
   - 启动并登录企业微信

2. **以管理员权限运行**
   ```bash
   # 右键"以管理员身份运行"PowerShell
   cd "项目目录"
   python wechat_message_forwarder.py
   ```

### 2. 企业微信测试（重要）

在使用转发功能前，**必须先测试企业微信独立窗口**：

```bash
python test_wecom_chat_window.py
```

按照提示：
1. 在企业微信中打开目标联系人的独立聊天窗口（如"无人机AI助教"）
2. 运行测试脚本验证是否可以操作

### 3. 配置转发规则

启动主程序后：

1. **源消息设置**
   - 选择微信类型（普通微信/企业微信）
   - 点击"刷新列表"获取联系人
   - 选择消息来源联系人或群组

2. **转发目标设置**
   - 选择目标微信类型
   - 选择目标联系人

3. **消息过滤条件**
   - 转发所有消息
   - 仅@本人的消息  
   - 指定范围的消息（从"@本人"到"@本人并说结束"）

4. **保存配置**
   - 点击"保存配置"保存当前设置
   - 下次启动时自动加载

### 4. 开始转发

1. 点击"开始转发"按钮
2. 观察日志输出确认运行状态
3. 需要停止时点击"停止转发"

## 使用示例

### 场景1：群消息转发到企业微信
- **源**: 普通微信 → "技术交流群"
- **目标**: 企业微信 → "无人机AI助教"
- **过滤**: 仅@本人的消息

### 场景2：企业微信回复转发到普通微信
- **源**: 企业微信 → "无人机AI助教"  
- **目标**: 普通微信 → "技术交流群"
- **过滤**: 转发所有消息

## 测试工具

### 1. 普通微信测试
```bash
python test_wechat.py
```

### 2. 企业微信窗口检测
```bash
python detect_wecom.py
```

### 3. 企业微信UI分析
```bash
python analyze_wecom_access.py
```

### 4. 企业微信聊天窗口测试
```bash
python test_wecom_chat_window.py
```

## 故障排除

### 常见问题

1. **"未找到微信窗口"**
   - 确保微信已启动并登录
   - 以管理员权限运行程序

2. **"无法获取联系人列表"**
   - 检查微信是否在前台
   - 重新启动微信应用

3. **"企业微信转发失败"**
   - 运行 `test_wecom_chat_window.py` 测试
   - 确保已打开独立聊天窗口
   - 检查联系人名称是否正确

4. **消息转发不及时**
   - 检查网络连接
   - 确保微信应用保持活跃状态

### 调试建议

1. **查看日志**: 程序界面下方的日志区域会显示详细的运行信息

2. **分步测试**: 
   - 先测试普通微信功能
   - 再测试企业微信独立窗口
   - 最后测试完整转发流程

3. **权限检查**: 确保以管理员权限运行所有相关程序

## 注意事项

1. **合规使用**: 请遵守企业微信和微信的使用条款
2. **数据安全**: 转发的消息可能包含敏感信息，请谨慎配置
3. **稳定性**: 微信应用更新可能影响程序运行，如遇问题请及时反馈
4. **性能**: 大量消息转发可能影响微信应用性能

## 技术原理

### UIAutomation技术
- 普通微信：完全支持UIAutomation
- 企业微信：主窗口使用自定义渲染，需要通过独立窗口操作

### 消息监听机制
- 基于wxauto的消息监听功能
- 实时检测新消息并触发转发

### 跨平台兼容
- 目前仅支持Windows平台
- 依赖Windows UIAutomation API

## 更新日志

### v1.0.0
- 初始版本发布
- 支持普通微信和企业微信消息转发
- 提供GUI配置界面
- 包含完整的测试工具

## 支持和反馈

如遇问题或有改进建议，请：
1. 查看故障排除部分
2. 运行相关测试工具
3. 提供详细的错误日志
4. 说明操作系统和微信版本信息

---

**祝您使用愉快！** 🎉